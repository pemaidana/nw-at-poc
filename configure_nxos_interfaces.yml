---

- name: General Config on Physical Interfaces
  hosts: nxos
  gather_facts: no
  tasks:
    - name: Add description to interfaces
      nxos_interfaces:
        config:
          - name: Ethernet1/10
            description: 'L3 interface by Ansible Tower'
            enabled: True
          - name: Ethernet1/11
            description: 'L2 interface by Ansible Tower'
            enabled: True
        state: merged

- name: VLAN Provision
  hosts: nxos
  gather_facts: no
  tasks:
    - name: Create a vlan on device
      nxos_vlans:
        config:
          - vlan_id: "{{ vlan }}"
            name: "{{ vlan_descr }}"
            state: active
        state: replaced

- name:  L2 and L3 config on interfaces
  hosts: nxos
  gather_facts: no
  tasks:
    - name: Configure L3 Interfaces
      nxos_l3_interfaces:
        config:
          - name: Ethernet1/10
            ipv4: "{{ l3_ip }}
        state: merged

    - name: Configure L2 Interfaces
      nxos_l2_interfaces:
        config:
          - name: interface=Ethernet1/11
            trunk:
            trunk_vlans: "{{ vlan }}"
        state: merged
 
